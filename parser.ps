%!

% Stackbasierte Sprachen - WS 2010
%
% Matthias Tretter - 0726390
% Philip Messlehner - 
% Perl Thomas -
%
% Limitations: Only works with one Tag per Line!!!
% Explanation: Problems with handling multiple search results because of readline-command

% Ein simpler XML-Parser in PostScript

% Stack-Effekt-Kommentare haben die Form
% SE funtionsname: parameter1 parameter2 parameterX -- returnwert1 returnwert2 returnwertX



% Procedure to exclude style-Attribute and stuff like that for Tag
% SE prepareTag: tagWithStyleAttributes -- tag
/prepareTag {
	( ) search { % search for whitespace
		exch	% new ordering post pre match
		pop		% pop whitespace
		exch	% new ordering pre post
		pop		% pop style-Attribute
	}
	{
		% do nothing --> Element is the Tag
	} ifelse
} def


% Define Procedure for handling SearchTerm
% SE analyzeSearchResult: post --
% TODO: change SE: to post -- tag
/analyzeSearchResult {
	
	% searching for '</'	(SE search: string -- post match pre true 
    %                            OR string -- false)
	(</) search {
		% EndTag Found
		% TDOD: EndTagHandling
		pop		% pop pre (Text before Tag begins)
		pop		% pop '</'
		pop		% pop endTag
	}
	{
		(<) search { % search for BeginTag
			pop		% pop pre (Text before Tag begins)
			pop		% pop '<'
			prepareTag
			print	% print Tag
			(\n) print
		}
		{
			pop
		} ifelse
	} ifelse
} def


/buffer 128 string def				%setup buffer for readline
currentfile buffer readline


% Main-Procedure
% SE main:  --
/main {
	/buffer 128 string def				%setup buffer for readline
	currentfile buffer readline
	/input (input/valid2.xml) (r) file def	%defines Inputfile
	
	{ % start loop
		% reading one line (SE readline: input buffer -- string bool)
		input buffer readline {
			{ %start loop for multiple tags in one line
				% searching for '>'	(SE search: string -- post match pre true 
		    		%                            OR string -- false)
					(>) search {			
						analyzeSearchResult
						pop		% pop > Sign
					} % if-path
					{ % else-path (search)
						pop						% pops string of search command
						exit					% and exits loop
					} ifelse
			} loop
		}
		{ % else-path (readline)
			pop		% pops string for readline command
			exit	% and exits loop
		} ifelse
	} loop

	% close File
	input closefile
} def

% call main-procedure
main
